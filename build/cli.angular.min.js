/**
 * cli-panel - Command line interface for sites
 * @author Liksu
 * @version v0.10.4
 * @link http://liksu.github.io/cli-panel/
 * @license MIT
 */
"use strict";function _typeof(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function _typeof(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function _typeof(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}window.cli=new function(){var e=this,n=this;this.cache={commandInput:null,buffer:null,panel:null,show:!1,loading:!1},this.history=[],this.settings={prompt:"> ",tab:"    ",debug:0},this.workers={pre:[],commands:{},post:[],keys:{}},localStorage&&localStorage.cliHistory&&(this.history=JSON.parse(localStorage.cliHistory)),this.templates={},this.addHtml=function(e,n,t){this.templates[e]={html:n,selector:t||"body"}}.bind(this),this.init=function(e){var n=this;if(this.cache.inited)return void 0;"object"===("undefined"==typeof e?"undefined":_typeof(e))&&Object.keys(e).forEach(function(t){return n.settings[t]=e[t]});var t=this.templates,i={};Object.keys(t).forEach(function(e){var n=t[e].selector;i[n]||(i[n]=document.createElement("div"),i[n].className="cli cli-panel",i[n].id="cli",i[n].innerHTML=""),i[n].innerHTML+=t[e].html}),Object.keys(i).forEach(function(e){document.querySelector(e).appendChild(i[e])}),this.cache.panel=document.querySelector(".cli.cli-panel"),this.cache.panel.addEventListener("mouseup",this.mouseUp),this.cache.line=this.cache.panel.querySelector(".cli-line"),this.cache.commandInput=this.cache.panel.querySelector(".cli .cli-line .cli-command"),this.cache.buffer=this.cache.panel.querySelector(".cli-history"),this.cache.loader=this.cache.panel.querySelector(".cli-loader"),this.cache.prompt=this.cache.panel.querySelector(".cli-prompt"),this.setPrompt(),this.toggle(this.cache.show),this.cache.inited=!0}.bind(this),document.addEventListener("DOMContentLoaded",this.init),document.addEventListener("keydown",function(e){var n=e.target===this.cache.commandInput;this.workers.keys[e.keyCode]&&this.workers.keys[e.keyCode].forEach(function(t){return t.worker(e,n)}),this.workers.keys[0]&&this.workers.keys[0].forEach(function(t){return t.worker(e,n)})}.bind(this)),this.show=function(){this.cache.panel.className+=" show",this.cache.show=!0,this.focus()}.bind(this),this.hide=function(){this.cache.panel.className=this.cache.panel.className.replace(/\s*show/g,""),this.cache.show=!1}.bind(this),this.toggle=function(e){void 0===e&&(e=!this.cache.show),e?this.show():this.hide()}.bind(this),this.mouseUp=function(e){var n="";window.getSelection?n=window.getSelection().toString():document.selection&&"Control"!=document.selection.type&&(n=document.selection.createRange().text),n||e.target===this.cache.commandInput||this.focus()}.bind(this),this.focus=function(){var e=this.cache.commandInput;setTimeout(function(){var n=e.value.length;if(e.setSelectionRange)e.setSelectionRange(n,n);else if("number"==typeof e.selectionStart)e.selectionStart=e.selectionEnd=n;else if("undefined"!=typeof e.createTextRange){e.focus();var t=e.createTextRange();t.collapse(!0),t.moveEnd(n),t.moveStart(n),t.select()}e.focus()},0)}.bind(this),this.startLoading=function(){e.cache.loading=!0,e.cache.loader.className=e.cache.loader.className.replace(/\s*hide_element\s*/,""),e.cache.line.className+=" hide_element",e.cache.commandInput.disabled=!0;var n=[{"char":"|",duration:100},{"char":"/",duration:80},{"char":"-",duration:100},{"char":"\\",duration:80}].map(function(t,i,o){return function(){var e=this;this.cache.loader.innerHTML=t["char"],setTimeout(function(){e.cache.loading&&n[i===o.length-1?0:i+1]()},t.duration)}.bind(e)});n[0]()},this.stopLoading=function(){e.cache.loading=!1,e.cache.loader.innerHTML="done",e.cache.loader.className+=" hide_element",e.cache.line.className=e.cache.line.className.replace(/\s*hide_element\s*/,""),e.cache.commandInput.disabled=!1,e.focus()},this.log=function(){for(var n=arguments.length,t=Array(n),i=0;n>i;i++)t[i]=arguments[i];e.settings.debug},this.setPrompt=function(e,n){void 0===e?e=this.settings.prompt:n&&(this.settings.prompt=e),this.cache.prompt.innerHTML=e}.bind(this),this.print=function(e){this.cache.buffer.innerHTML+=(""+e).replace(/\t/g,this.settings.tab)+"\n"}.bind(this),this.run=function(e){var t=this;if(e){this.history.push(e.trim());var i=void 0,o=this.history.length;do i=JSON.stringify(this.history.slice(-o--));while(i.length>2e6);localStorage.cliHistory=i}var r={input:e.trim(),original:e,command:null,argv:{},result:null},c=new Promise(function(e,n){t.startLoading(),e(r)});return this.workers.pre.forEach(function(e){return e.forEach(function(e){n.log("promise pre",e),c=c.then(function(n){return e.worker(n)||n})})}),c=c.then(function(e){return new Promise(function(i,o){n.log("promise command",e);var r;return e.command&&(r=t.workers.commands[e.command])?(n.log("promise run command",r),i(r.worker(e)||e)):i(e)})}).then(function(e){return e||r}),this.workers.post.forEach(function(e){return e.forEach(function(e){n.log("promise post",e),c=c.then(function(n){return e.worker(n)||n})})}),c.then(function(e){return t.stopLoading()})}.bind(this);var t=function(e,t,i,o,r){r||(r=0),void 0===o&&"function"==typeof i&&(o=i,i=null);var c={name:t,description:i,worker:function(){for(var i=arguments.length,r=Array(i),c=0;i>c;c++)r[c]=arguments[c];n.log("call worker",e,t,"with arguments:",r);var s=o.apply(null,r);return n.log("and result:",s),s}};"command"===e?this.workers.commands[t]=c:"keys"===e?(this.workers.keys[t]||(this.workers.keys[t]=[]),this.workers.keys[t].push(c)):(this.workers[e][r]||(this.workers[e][r]=[]),this.workers[e][r].push(c))}.bind(this);this.command=t.bind(this,"command"),this.preprocessor=t.bind(this,"pre"),this.postprocessor=t.bind(this,"post"),this.registerKey=t.bind(this,"keys")},window.cli.version="0.10.4",function(e){e.command("clear","Clear screen",function(n){e.log("execute command clear"),e.cache.buffer.innerHTML=""})}(window.cli),function(e){e.command("help","Display this list",function(n){e.log("execute command help"),e.print("Command line interface for sites."),e.print("Version: "+e.version),e.print(""),e.print("List of available commands:"),Object.keys(e.workers.commands).sort().forEach(function(n){var t=e.workers.commands[n].description;e.print(["	",n,t?"- "+t:""].join(" "))})})}(window.cli),function(e){e.registerKey(9,"Tab",function(n,t){if(e.log("process key Tab for autocomplete"),t){n.preventDefault();var i=e.cache.commandInput.value;i=new RegExp("^"+i);var o=Object.keys(e.workers.commands).sort(function(e,n){return e.length-n.length}).filter(function(e){return i.test(e)});o.length&&(1===o.length?e.cache.commandInput.value=o[0]+" ":e.print(o.join("	")))}})}(window.cli),function(e){e.registerKey(0,"Echo",function(n,t){e.log("echo pressed key",n.keyCode,n)})}(window.cli),function(e){function n(n){e.cache.commandInput.value=n,e.focus()}var t="",i=0;e.registerKey(38,"Up",function(o,r){e.log("process key Up for history"),r&&i!=e.history.length&&(i||(t=e.cache.commandInput.value),i++,i>e.history.length&&(i=e.history.length),n(e.history[e.history.length-i]))}),e.registerKey(40,"Down",function(o,r){if(e.log("process key Down for history"),r&&i){i--;var c="";0>=i?(i=0,c=t):c=e.history[e.history.length-i],n(c)}}),e.registerKey(13,"Enter",function(n,o){e.log("process key Enter for history"),t="",i=0})}(window.cli),function(e){e.registerKey(13,"Enter",function(n,t){e.log("process key Enter for run"),t&&(e.print(e.cache.prompt.outerHTML+e.cache.commandInput.value),e.run(e.cache.commandInput.value),e.cache.buffer.scrollTop=e.cache.buffer.scrollHeight,e.cache.commandInput.value="")})}(window.cli),function(e){e.registerKey(192,"`",function(n,t){e.log("process key ` for show"),("INPUT"!==n.target.nodeName||t)&&(t&&n.preventDefault(),e.toggle())})}(window.cli),function(e){function n(e){for(;/[+-]{2}/.test(e);)e=e.replace(/([+-]{2})/,function(e){return r[e]});for(;s.test(e);)e=e.replace(s,"$1 $2 $3");return e=e.split(new RegExp(c)).map(function(e){return e.trim()}).filter(function(e){return""!==e}).map(function(e){return isNaN(+e)?e:+e}).filter(function(e,n,t){if("string"!=typeof e)return!0;if(-1===i.indexOf(e))throw new SyntaxError("invalid operator "+e);return!(0===n||n===t.length-1)}).join(" "),i.forEach(function(n){for(var t=[""].concat(n.split("")).join("\\"),i=new RegExp(c+" ("+t+") "+c);new RegExp(t).test(e);)e=e.replace(i,function(e,n,t,i){return o[t](+n,+i)})}),+e}function t(e){for(;/\(([^()]*)\)/.test(e);)e=e.replace(RegExp.lastMatch,n(RegExp.$1));return e=e.replace(/[()]/g,""),e=n(e),+e}var i="** log * / - +".split(" "),o={"+":function(e,n){return e+n},"-":function(e,n){return e-n},"*":function(e,n){return e*n},"/":function(e,n){return e/n},"**":function(e,n){return Math.pow(e,n)},log:function(e,n){return Math.log(e)/Math.log(n)}},r={"++":"+ ","--":"+ ","+-":"- ","-+":"- "},c="([-+]?(?:\\d*\\.)?\\d+(?:e[+-]?\\d+)?)",s=/(\d)([+-])([\d.])/g;e.postprocessor("calc","Simple calculator",function(n){e.log("execute POST processor calc");var i=n.input;if(!i)return n;if(!/^[log\s\d.e()\/*+-]+$/.test(i))return n;try{n.result=t(i),e.print(n.result),n.input=""}catch(o){e.print(o.name+": "+o.message)}return n})}(window.cli),function(e){e.postprocessor("eval","Run js code",function(n){var t=n.input;if(!t)return n;try{var i=n.result=new Function("return "+t)();e.print("object"!==("undefined"==typeof i?"undefined":_typeof(i))?i:JSON.stringify(i)),n.input=""}catch(o){e.print(o.name+": "+o.message)}return n},1e3)}(window.cli),function(e){function n(e){var n={_:[]};if(!e)return n;var t=e.match(/^(.*?)\s+\-\-\s+(.*)$/);if(t&&(e=t[1],t=t[2]),!e)return n._=[t],n;for(var i=e.split(""),o=[],r=!1,c=!1,s=[],a=0;a<=i.length;a++)if("\\"!==i[a])if(r)r=!1;else{if('"'===i[a]||"'"===i[a]){if(!c){o.push(s.join("").trim()),s=[],c={"char":i[a],position:a,text:[]};continue}if(c["char"]===i[a]){c.text=c.text.join(""),o.push(c),c=!1;continue}}c?c.text.push(i[a]):s.push(i[a])}else r=!0;for(o.push(s.join("").trim()),o=o.map(function(e){return"string"==typeof e?e.split(/\s+|=/):e}),o=[].concat.apply([],o),o=o.map(function(e){if(/^\-([^-]+)$/.test(e))return{flags:RegExp.$1.split("")};if(/^\-\-(.+)$/.test(e)){var n=RegExp.$1;return n=n.split("-").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join(""),n=n.charAt(0).toLowerCase()+n.slice(1),{param:n}}return e}),o=o.map(function(e){return e.text||e}),o.push(t);o.length;){var l=o.shift();if(l)if("object"!==("undefined"==typeof l?"undefined":_typeof(l)))n._.push(l);else{var u=l.param;if(l.flags)for(u=l.flags.pop();l.flags.length;)n[l.flags.shift()]=!0;if("string"==typeof o[0]){n[u]=o.shift(),!isNaN(parseFloat(n[u]))&&isFinite(n[u])&&(n[u]=+n[u]);var h={"true":!0,"false":!1,"null":null,undefined:void 0};h.hasOwnProperty(n[u])&&(n[u]=h[n[u]])}else n[u]=!0}}return n}e.preprocessor("argv","Split command line to arguments",function(t){if(e.log("execute PRE processor argv"),!t.input)return t;t.command=null;var i=Object.keys(e.workers.commands).sort(function(e,n){return n.length-e.length});return i.some(function(e){return 0===t.input.indexOf(e)&&(t.command=e,t.input=t.input.replace(e,"").trim()),t.command}),t.command&&(t.argv=n(t.input),t.input=""),e.log("argv result",t),t})}(window.cli),function(e){e.addHtml("templates/panel.html",'<div class="cli-history"></div><div class="cli-loader hide_element"></div><div class="cli-line"><span class="cli-prompt"></span><input type="text" autofocus="autofocus" class="cli-command"/></div>',"body")}(window.cli),!function(){var e="body #cli.cli.cli-panel {\n  z-index: 65535;\n  top: 0;\n  left: 0;\n  max-height: 64%;\n  height: 0;\n  position: absolute;\n  right: 0;\n  color: white;\n  font: 16px monospace;\n  background: rgba(0, 0, 0, 0.8);\n  line-height: 20px;\n  transition: height 0.64s linear; }\n  body #cli.cli.cli-panel.show {\n    height: 64%; }\n  body #cli.cli.cli-panel .cli-history {\n    overflow: auto;\n    white-space: pre-wrap;\n    position: absolute;\n    bottom: 20px;\n    width: 100%; }\n    body #cli.cli.cli-panel .cli-history .cli-prompt {\n      display: inline;\n      width: auto; }\n  body #cli.cli.cli-panel .cli-line {\n    position: absolute;\n    bottom: 0;\n    height: 20px;\n    width: 100%;\n    display: table; }\n  body #cli.cli.cli-panel .cli-prompt {\n    display: table-cell;\n    width: 1px; }\n  body #cli.cli.cli-panel input[type=text].cli-command {\n    background: none;\n    border: 0;\n    color: white;\n    outline: none;\n    font: 16px monospace;\n    padding-left: 9px;\n    width: 100%;\n    box-sizing: border-box;\n    display: table-cell; }\n  body #cli.cli.cli-panel .cli-loader {\n    position: absolute;\n    bottom: 0;\n    height: 20px; }\n  body #cli.cli.cli-panel .hide_element {\n    display: none; }\n",n=document.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e)),(document.head||document.getElementsByTagName("head")[0]).appendChild(n)}(),function(e){!function(e){angular.modules=[],angular.module=function(){return arguments.length>1&&angular.modules.push(arguments[0]),e.apply(null,arguments)}}(angular.module),angular.module("cli",[]).factory("$cli",function(){return e.ng={controllers:{},directives:{},services:{}},e.ng.c=e.ng.controllers,e.ng.d=e.ng.directives,e.ng.s=e.ng.services,e})}(window.cli),function(e){try{e.workers.post[1e3].shift()}catch(n){}e.postprocessor("eval","Run js code with angular objects",function(n){var t=n.input;if(!t)return n;try{var i={};["services","directives","controllers"].forEach(function(n){var o="";"directives"===n&&(o="(\\[\\d+\\])?"),Object.keys(e.ng[n]).forEach(function(e){var r=new RegExp("(^|[^\\w.])"+e.replace(/(\W)/g,"\\$1")+o,"g"),c="this."+n+"."+e;t=t.replace(r,function(e,t,o){return"string"!=typeof o&&(o=""),"services"!==n&&(i[c+o]=!0),t+c+o})})});var o=n.result=new Function("return "+t).call(e.ng);new Function(Object.keys(i).map(function(e){return"if ("+e+".$apply) {"+e+".$apply()}"}).join(";")).call(e.ng),e.print("object"!==("undefined"==typeof o?"undefined":_typeof(o))?o:JSON.stringify(o)),n.input=""}catch(r){e.print(r.name+": "+r.message)}return n},1e3)}(window.cli),function(e){e.command("help ng","Display list of available angular components",function(n){e.print("List of available angular components:"),["services","directives","controllers"].forEach(function(n){e.print("	"+n+": "+Object.keys(e.ng[n]).join(", "))})})}(window.cli),function(e){angular.module("cli").run(["$injector","$cli",function(n,t){var i=angular.modules.reduce(function(e,n){return e.concat(angular.module(n)._invokeQueue)},[]),o=i.filter(function(e){return"service"===e[1]}).map(function(e){return e[2][0]});o.push("$http","$q"),o.forEach(function(t){return e.ng.services[t]=n.get(t)});i.filter(function(e){return"$controllerProvider"===e[0]||"controller"===e[1]||"directive"===e[1]}).map(function(e){return e[2][0]}).concat(o)}]),angular.module("cli").config(["$provide",function(n){angular.modules=angular.modules.filter(function(e){return"cli"!==e}),angular.modules.forEach(function(n){var t=angular.module(n)._invokeQueue.filter(function(e){return"directive"===e[1]}).map(function(e){return e[2][0]});t.forEach(function(t){angular.module(n).config(function(n){n.decorator(t+"Directive",function(n){return n[0].compile=function(){return function(i,o,r){n[0].link.apply(this,arguments),e.ng.directives[t]||(e.ng.directives[t]=[]),i.$cliPosition=e.ng.directives[t].push(i)-1,i.$on("$destroy",function(){return e.ng.directives[t].splice(i.$cliPosition,1)})}},n})})})}),n.decorator("$controller",["$delegate",function(n){return function(t,i,o,r){return"string"==typeof t&&(e.ng.controllers[t]=i.$scope),n(t,i,o,r)}}])}])}(window.cli);