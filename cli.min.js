angular.module("cli",[]),angular.module("cli").run(function(){var n=angular.element("<ng-cli></ng-cli>");angular.element(document.body).append(n)}),angular.module("cli").service("$cli",function(n){this.prompt="> ",this.buffer="",this.history=[],this.workers={pre:[],commands:{},post:[]},this.print=function(n){this.buffer+=n+"\n"}.bind(this),this.run=function(e){this.history.push(e);var o={input:e,original:e,command:null,argv:{},result:null};console.log("run",o);var t=this.workers.pre.reduce(function(e,t,r){return n.when(e).then(function(){return console.log("pre",t,o),t.worker(o)})},o);return t=n.when(t).then(function(){var e;return console.log("check command",o,this.workers.commands),o.command&&(e=this.workers.commands[o.command])?n.when(e.worker(o)).then(function(n){o=n||o}):n.when(o)}.bind(this)),t=n.when(t).then(function(){this.workers.post.reduce(function(e,t,r){return n.when(e).then(function(){return t.worker(o)})},n.when(o))}.bind(this)),t.then(function(){return o})}.bind(this);var e=function(n,e,o,t){void 0===t&&"function"==typeof o&&(t=o,o=null);var r={name:e,description:o,worker:t};"command"===n?this.workers.commands[e]=r:this.workers[n].push(r)};return this.command=e.bind(this,"command"),this.preprocessor=e.bind(this,"pre"),this.postprocessor=e.bind(this,"post"),this}),angular.module("cli").directive("ngCli",function(n){return{templateUrl:"/panel.html",replace:!0,controller:function(e,o){e.show=!0;var t=o.print;o.print=function(n){null!==n&&t(n),e.buffer=o.buffer.replace(/\t/g,"    ").replace(/  /g," Â ")},e.prompt=o.prompt;var r=document.querySelector(".cli .panel .line .command"),i=document.querySelector(".cli .panel .buffer");e.focus=function(){n(function(){var n=r.value.length;if(r.setSelectionRange)r.setSelectionRange(n,n);else if("number"==typeof r.selectionStart)r.selectionStart=r.selectionEnd=n;else if("undefined"!=typeof r.createTextRange){r.focus();var e=r.createTextRange();e.collapse(!0),e.moveEnd(n),e.moveStart(n),e.select()}r.focus()},0)},document.addEventListener("keydown",function(n){if(192===n.keyCode){if("INPUT"===n.target.nodeName&&n.target!==r)return;e.show=!e.show,e.show&&e.focus()}else 13===n.keyCode&&n.target===r&&(o.print(o.prompt+e.command),o.run(e.command),i.scrollTop=i.scrollHeight,e.command="");e.$apply()})}}}),angular.module("cli").run(function(n){n.preprocessor("argv","Split command line to arguments",function(e){if(!e.input)return e;var o=e.input.match(/^\w+/);return-1!==Object.keys(n.workers.commands).indexOf(o&&o[0])&&(e.command=o[0],e.input=e.input.replace(o[0],"")),console.log("argv",e.command),e})}),angular.module("cli").run(function(n){n.command("clear","Clear screen",function(e){n.buffer="",n.print(null)})}),angular.module("cli").run(function(n){n.command("help","Display this list",function(e){n.print("List of available commands:"),Object.keys(n.workers.commands).sort().forEach(function(e){var o=n.workers.commands[e].description;n.print(["	",e,o?"- "+o:""].join(" "))}),console.log("in help",e)})}),angular.module("cli").run(function($cli){function calc(string){return eval(string)}$cli.postprocessor("calc","Calculate input",function(n){return n.input?($cli.print(calc(n.input)),n):n})}),angular.module("cli").run(["$templateCache",function(n){n.put("/panel.html",'<div class="cli">\n	<style>\n		.panel {\n			height: 64%;\n			position: absolute;\n			top: 0;\n			left: 0;\n			right: 0;\n			color: white;\n			font: 16px monospace;\n			background: rgba(0, 0, 0, 0.8);\n			line-height: 20px;\n		}\n		.buffer {\n			overflow: auto;\n			white-space: pre-line;\n			position: absolute;\n			bottom: 20px;\n		}\n		.line {\n			position: absolute;\n			bottom: 0;\n			height: 20px;\n		}\n		.command {\n			background: none;\n			border: 0;\n			color: white;\n			outline: none;\n			font: 16px monospace;\n		}\n	</style>\n\n	<div class="panel" ng-show="show" ng-click="focus()">\n		<div class="buffer">{{buffer}}<span class="loader" ng-show="loading"></span></div>\n		<div class="line">\n			<span class="prompt">{{prompt}}</span>\n			<input type="text" class="command" ng-model="command" autofocus="autofocus"/>\n		</div>\n	</div>\n</div>')}]);